(thetaS <- atan2(v[2], v[3]))*180/pi
v
(thetaS <- atan2(v[2], v[3]))
?rotate3d
(thetaV <- 3* pi/4)
(v <- c(cos(thetaV), sin(thetaV), cos(thetaV)))
asHomogeneous(v)
asEuclidean(v)
asEuclidean(asHomogeneous(v))
(thetaV <- 3* pi/4)
(v <- c(cos(thetaV), sin(thetaV), cos(thetaV)))
(thetaF <- atan2(v[2], v[1])-pi/2)
(v <- rgl::rotate3d(v, thetaF, 0, 0, 1)) # 0 1 -.707
(thetaS <- atan2(v[2], v[3]))
(v <- rgl::rotate3d(v, thetaS, 1, 0, 0)) # 0 0 1
(thetaV <- 3* pi/4)
(v <- c(cos(thetaV), sin(thetaV), cos(thetaV)))
(thetaF <- atan2(v[2], v[1])-pi/2)
(v <- rgl::rotate3d(v, thetaF, 0, 0, 1)) # 0 1 -.707
(thetaS <- atan2(v[2], v[3]))
(v <- rgl::rotate3d(v, thetaS, 1, 0, 0)) # 0 0 1
(thetaV <- 3* pi/4)
(v <- c(cos(thetaV), sin(thetaV), cos(thetaV)))
(thetaF <- atan2(v[2], v[1])-pi/2)
(v <- rgl::rotate3d(v, thetaF, 0, 0, 1)) # 0 1 -.707
(thetaS <- atan2(v[2], v[3]))
(v <- rgl::rotate3d(v, -thetaS, 1, 0, 0)) # 0 0 1
(thetaV <- 3* pi/4)
(v <- c(cos(thetaV), sin(thetaV), cos(thetaV)))
(thetaF <- atan2(v[2], v[1])-pi/2)
(v <- rgl::rotate3d(v, thetaF, 0, 0, 1)) # 0 1 -.707
(thetaS <- atan2(v[3], v[2]))
(v <- rgl::rotate3d(v, -thetaS, 1, 0, 0)) # 0 0 1
(thetaV <- 3* pi/4)
(v <- c(cos(thetaV), sin(thetaV), cos(thetaV)))
(thetaF <- atan2(v[2], v[1])-pi/2)
(v <- rgl::rotate3d(v, thetaF, 0, 0, 1)) # 0 1 -.707
(thetaS <- atan2(v[3], v[2]))
(v <- rgl::rotate3d(v, thetaS, 1, 0, 0)) # 0 0 1
sqrt(2)
(thetaV <- 3* pi/4)
(v <- c(cos(thetaV), sin(thetaV), cos(thetaV)))
(thetaF <- atan2(v[2], v[1])-pi/2)
(v <- rgl::rotate3d(v, thetaF, 0, 0, 1)) # 0 1 -.707
(thetaS <- atan2(v[2], v[3]))
(v <- rgl::rotate3d(v, thetaS, 1, 0, 0)) # 0 0 1
(thetaV <- 3* pi/4)
(v <- c(cos(thetaV), sin(thetaV), cos(thetaV)))
(thetaF <- atan2(v[2], v[1])-pi/2)
(v <- rgl::rotate3d(v, thetaF, 0, 0, 1)) # 0 1 -.707
(thetaS <- atan2(v[3], v[2]))
(v <- rgl::rotate3d(v, thetaS, 1, 0, 0)) # 0 0 1
(thetaV <- 3* pi/4)
(v <- c(cos(thetaV), sin(thetaV), cos(thetaV)))
(thetaF <- atan2(v[2], v[1])-pi/2)
(v <- rgl::rotate3d(v, thetaF, 0, 0, 1)) # 0 1 -.707
(thetaS <- atan2(v[3], v[2]))
(v <- rgl::rotate3d(v, thetaS, 0, 1, 0)) # 0 0 1
(thetaV <- 3* pi/4)
(v <- c(cos(thetaV), sin(thetaV), cos(thetaV)))
(thetaF <- atan2(v[2], v[1])-pi/2)
(v <- rgl::rotate3d(v, thetaF, 0, 0, 1)) # 0 1 -.707
(thetaS <- atan2(v[3], v[2]))
(v <- rgl::rotate3d(v, -thetaS, 1, 0, 0)) # 0 0 1
(thetaV <- 3* pi/4)
(v <- c(cos(thetaV), sin(thetaV), cos(thetaV)))
(thetaF <- atan2(v[2], v[1])-pi/2)
(v <- rgl::rotate3d(v, thetaF, 0, 0, 1)) # 0 1 -.707
(thetaS <- atan2(v[3], v[2]))
(v <- rgl::rotate3d(v, -thetaS, 1, 0, 0)) # 0 0 1
(thetaV <- 3* pi/4)
(v <- c(cos(thetaV), sin(thetaV), cos(thetaV)))
(thetaF <- atan2(v[2], v[1])-pi/2)
(v <- rgl::rotate3d(v, thetaF, 0, 0, 1)) # 0 1 -.707
(thetaS <- atan2(v[3], v[2]))
(v <- rgl::rotate3d(v, -thetaS, 1, 0, 0)) # 0 0 1
(thetaV <- 3* pi/4)
(v <- c(cos(thetaV), sin(thetaV), cos(thetaV)))
(thetaF <- atan2(v[2], v[1])-pi/2)
(v <- rgl::rotate3d(v, thetaF, 0, 0, 1)) # 0 1 -.707
(thetaS <- atan2(v[2], v[3]))
(v <- rgl::rotate3d(v, -thetaS, 1, 0, 0)) # 0 0 1
(thetaV <- 3* pi/4)
(v <- c(cos(thetaV), sin(thetaV), cos(thetaV)))
(thetaF <- atan2(v[2], v[1])-pi/2)
(v <- rgl::rotate3d(v, thetaF, 0, 0, 1)) # 0 1 -.707
(thetaS <- atan2(v[2], v[3]))
(v <- rgl::rotate3d(v, -thetaS, 1, 0, 0)) # 0 0 1
(thetaT <- atan2(v[1], v[3]))
(v <- rgl::rotate3d(v, thetaT, 0, 1, 0)) # 0 1 1
(thetaV <- 3* pi/4)
(v <- c(cos(thetaV), sin(thetaV), cos(thetaV)))
(thetaF <- atan2(v[2], v[1])-pi/2)
(v <- rgl::rotate3d(v, thetaF, 0, 0, 1)) # 0 1 -.707
(thetaS <- atan2(v[2], v[3]))
(v <- rgl::rotate3d(v, -thetaS, 1, 0, 0)) # 0 0 1
(thetaT <- atan2(v[1], v[3]))
(v <- rgl::rotate3d(v, thetaT, 0, 1, 0)) # 0 1 1
2 * sqrt(.707)
sqrt(.707^2 + .707^2)
(v <- rgl::rotate3d(v, thetaT, 0, 1, 0)) # 0 1 1
(thetaV <- 3* pi/4)
(v <- c(cos(thetaV), sin(thetaV), cos(thetaV))) # -.707 .707 -.707
(thetaF <- atan2(v[2], v[1])-pi/2)
(v <- rgl::rotate3d(v, thetaF, 0, 0, 1)) # 0 1 -.707
(thetaV <- 3* pi/4)
(v <- c(cos(thetaV), sin(thetaV), cos(thetaV))) # -.707 .707 -.707
(thetaF <- atan2(v[2], v[1])-pi/2)
(v <- rgl::rotate3d(v, thetaF, 0, 0, 1)) # 0 1 -.707
(thetaS <- atan2(v[2], v[3]))
(v <- rgl::rotate3d(v, -thetaS, 1, 0, 0)) # 0 0 1
(thetaV <- 3* pi/4)
(v <- c(cos(thetaV), sin(thetaV), cos(thetaV))) # -.707 .707 -.707
(thetaF <- atan2(v[2], v[1])-pi/2)
(v <- rgl::rotate3d(v, thetaF, 0, 0, 1)) # 0 1 -.707
(thetaV <- 3* pi/4)
(v <- c(cos(thetaV), sin(thetaV), sin(thetaV))) # -.707 .707 -.707
(thetaF <- atan2(v[2], v[1])-pi/2)
(v <- rgl::rotate3d(v, thetaF, 0, 0, 1)) # 0 1 -.707
(thetaS <- atan2(v[2], v[3]))
(v <- rgl::rotate3d(v, -thetaS, 1, 0, 0)) # 0 0 1
(thetaT <- atan2(v[1], v[3]))
(v <- rgl::rotate3d(v, thetaT, 0, 1, 0)) # 0 0 1
rotationMatrix(thetaV, 1,1,1)
v%*%rotationMatrix(thetaV, 1,1,1)
asHomogeneous(v)%*%rotationMatrix(thetaV, 1,1,1)
asHomogeneous(v)%*%rotationMatrix(-thetaV, 1,1,1)
(thetaV <- 3* pi/4)
(v <- c(cos(thetaV), sin(thetaV), sin(thetaV))) # -.707 .707 .707
rotationMatrix(rep(thetaV, 3), 1,1,1)
(thetaV <- 3* pi/4)
(v <- c(cos(thetaV), sin(thetaV), sin(thetaV))) # -.707 .707 .707
(thetaF <- atan2(v[2], v[1])-pi/2)
(v <- rgl::rotate3d(v, thetaF, 0, 0, 1)) # 0 1 -.707
(thetaS <- atan2(v[2], v[3]))
(v <- c(cos(thetaV), sin(thetaV), sin(thetaV))) # -.707 .707 .707
(thetaF <- atan2(v[2], v[1])-pi/2)
(v <- rgl::rotate3d(v, thetaF, 0, 0, 1)) # 0 1 -.707
(thetaS <- atan2(v[2], v[3]))
(thetaV <- 3* pi/4)
(v <- c(cos(thetaV), sin(thetaV), cos(thetaV))) # -.707 .707 -.707
(thetaF <- atan2(v[2], v[1])-pi/2)
(v <- rgl::rotate3d(v, thetaF, 0, 0, 1)) # 0 1 -.707
(thetaS <- atan2(v[2], v[3]))
(v <- rgl::rotate3d(v, -thetaS, 1, 0, 0)) # 0 0 1
(thetaT <- atan2(v[1], v[3]))
(v <- rgl::rotate3d(v, thetaT, 0, 1, 0)) # 0 0 1
(thetaV <- 3* pi/4)
(v <- c(cos(thetaV), sin(thetaV), cos(thetaV))) # -.707 .707 -.707
(thetaF <- atan2(v[2], v[1])-pi/2)
(v <- rgl::rotate3d(v, thetaF, 0, 0, 1)) # 0 1 -.707
(thetaV <- 3* pi/4)
(v <- c(cos(thetaV), sin(thetaV), cos(thetaV))) # -.707 .707 -.707
(thetaF <- atan2(v[2], v[1]))
(v <- rgl::rotate3d(v, thetaF, 0, 0, 1)) # 0 1 -.707
(thetaS <- atan2(v[2], v[3]))
(v <- rgl::rotate3d(v, -thetaS, 1, 0, 0)) # 0 0 1
(thetaT <- atan2(v[1], v[3]))
(v <- rgl::rotate3d(v, thetaT, 0, 1, 0)) # 0 0 1
sqrt(3*.707^2)
(thetaV <- 3* pi/4)
(v <- c(cos(thetaV), sin(thetaV), cos(thetaV))) # -.707 .707 -.707
(thetaF <- atan2(v[2], v[1]))
(v <- rgl::rotate3d(v, thetaF, 0, 0, 1)) # 0 1 -.707
(thetaS <- atan2(v[2], v[3]))
(v <- rgl::rotate3d(v, -thetaS, 1, 0, 0)) # 0 0 1
(thetaT <- atan2(v[1], v[3]))
(v <- rgl::rotate3d(v, thetaT, 0, 1, 0)) # 0 0 1
(thetaV <- 3* pi/4)
(v <- c(cos(thetaV), sin(thetaV), cos(thetaV))) # -.707 .707 -.707
(thetaF <- atan2(v[2], v[1]))
(v <- rgl::rotate3d(v, thetaF, 0, 0, 1)) # 0 1 -.707
(thetaS <- atan2(v[2], v[3]))
(v <- rgl::rotate3d(v, -thetaS, 1, 0, 0)) # 0 0 1
(thetaV <- 3* pi/4)
(v <- c(cos(thetaV), sin(thetaV), cos(thetaV))) # -.707 .707 -.707
(thetaF <- atan2(v[2], v[1]))
(v <- rgl::rotate3d(v, thetaF, 0, 0, 1)) # 0 1 -.707
(thetaS <- atan2(v[2], v[3]))
(v <- rgl::rotate3d(v, thetaS, 1, 0, 0)) # 1 0 .707
(thetaT <- atan2(v[1], v[3]))
(v <- rgl::rotate3d(v, thetaT, 0, 1, 0)) # 0 0 1
(thetaV <- 3* pi/4)
(v <- c(cos(thetaV), sin(thetaV), cos(thetaV))) # -.707 .707 -.707
(thetaF <- atan2(v[2], v[1]))
(v <- rgl::rotate3d(v, thetaF, 0, 0, 1)) # 0 1 -.707
(thetaS <- atan2(v[2], v[3]))
(v <- rgl::rotate3d(v, thetaS, 1, 0, 0)) # 1 0 .707
(thetaT <- atan2(v[1], v[3]))
(v <- rgl::rotate3d(v, thetaT, 0, 1, 0)) # 0 0 1
(thetaV <- 3* pi/4)
(v <- c(cos(thetaV), sin(thetaV), cos(thetaV))) # -.707 .707 -.707
(thetaF <- atan2(v[2], v[1]))
(v <- rgl::rotate3d(v, thetaF, 0, 0, 1)) # 0 1 -.707
(thetaS <- atan2(v[2], v[3]))
(v <- rgl::rotate3d(v, thetaS, 1, 0, 0)) # 1 0 .707
(thetaT <- atan2(v[1], v[3]))
(v <- rgl::rotate3d(v, thetaT, 0, 1, 0)) # 0 0 1.22
(thetaV <- 3* pi/4)
(v <- c(cos(thetaV), sin(thetaV), cos(thetaV))) # -.707 .707 -.707
(thetaF <- atan2(v[2], v[1]))
(v <- rgl::rotate3d(v, thetaF, 0, 0, 1)) # 1 0 -.707
(thetaT <- atan2(v[1], v[3]))
(v <- rgl::rotate3d(v, thetaT, 0, 1, 0)) # 0 0 1.22
(thetaS <- atan2(v[2], v[3]))
(v <- rgl::rotate3d(v, thetaS, 1, 0, 0)) # 1 0 .707
library(kinesis)
indData <- indData.backup - transData[rep(1, nrow(indData.backup)),]
thuData <- thuData.backup - transData[rep(1, nrow(thuData.backup)),]
# end coordinates of the whole grasp
end <- as.numeric(km.res[km.res$moment=="end",1:3] - km.res[km.res$moment=="start",1:3]) # centered end coordinates
# rotate trajectories
indData <- kin.rotate.trajectory(indData, end)
thuData <- kin.rotate.trajectory(thuData, end)
# polish rotated dataset
indData <- as.data.frame(indData)
names(indData) <- c("indexX","indexY","indexZ")
thuData <- as.data.frame(thuData)
names(thuData) <- c("thumbX","thumbY","thumbZ")
plot3d(rotData[c(1,3,2)])
points3d(indData[c(1,3,2)], col="red")
points3d(thuData[c(1,3,2)], col="blue")
points3d(indData[c(1,3,2)], col="red")
indData <- indData.backup - transData[rep(1, nrow(indData.backup)),]
thuData <- thuData.backup - transData[rep(1, nrow(thuData.backup)),]
end <- as.numeric(km.res[km.res$moment=="end",1:3] - km.res[km.res$moment=="start",1:3]) # centered end coordinates
indData <- kin.rotate.trajectory(indData, end)
thuData <- kin.rotate.trajectory(thuData, end)
library(kinesis)
indData <- indData.backup - transData[rep(1, nrow(indData.backup)),]
thuData <- thuData.backup - transData[rep(1, nrow(thuData.backup)),]
end <- as.numeric(km.res[km.res$moment=="end",1:3] - km.res[km.res$moment=="start",1:3]) # centered end coordinates
indData <- kin.rotate.trajectory(indData, end)
thuData <- kin.rotate.trajectory(thuData, end)
indData <- as.data.frame(indData)
names(indData) <- c("indexX","indexY","indexZ")
thuData <- as.data.frame(thuData)
names(thuData) <- c("thumbX","thumbY","thumbZ")
plot3d(rotData[c(1,3,2)])
points3d(indData[c(1,3,2)], col="red")
points3d(thuData[c(1,3,2)], col="blue")
library(kinesis)
options(scipen = 1, digits = 3)
libraries()
library(cowplot)
# PROCEDURE FROM GALLIVAN and CHAPMAN 2014
#### Prepare the dataset ####
# keep only useful columns
usefCols <- c("trialN","indexXraw","indexYraw","indexZraw","thumbXraw","thumbYraw","thumbZraw")
# Fix dataset
testData <- data.check(rtgData_bad[usefCols])
test
# is there missing data for each digit in this dataset?
any(testData$fingersOccluded==1) # YES
#### 1. individual trial analysis ####
###  1.1 extract ROI ----
##   1.1.1 fill in missing frames ----
# inpaint_nans function in matlab
# select one trial with missing frames
# flag trials with missing frames
testData <- ddply(testData, .(trialN), mutate,
missing.frames = any(framesOccluded > 0))
# extract these trials number
trial.na.frame <- unique(subset(testData, missing.frames)$trialN)
# pick a random bad trial
badTrialNum <- 40
testTrial <- subset(testData, trialN == badTrialNum)
# plot the data
ggplot(aes(frameN, thumbXraw, color = fingersOccluded), data = testTrial) + geom_point() # thumb data is bad
ggplot(aes(frameN, indexXraw, color = fingersOccluded), data = testTrial) + geom_point() # index data is OK
library(kinesis)
options(scipen = 1, digits = 3)
libraries()
library(cowplot)
# PROCEDURE FROM GALLIVAN and CHAPMAN 2014
#### Prepare the dataset ####
# keep only useful columns
usefCols <- c("trialN","indexXraw","indexYraw","indexZraw","thumbXraw","thumbYraw","thumbZraw")
# Fix dataset
testData <- data.check(rtgData_bad[usefCols])
# is there missing data for each digit in this dataset?
any(testData$fingersOccluded==1) # YES
#### 1. individual trial analysis ####
###  1.1 extract ROI ----
##   1.1.1 fill in missing frames ----
# inpaint_nans function in matlab
# select one trial with missing frames
# flag trials with missing frames
testData <- ddply(testData, .(trialN), mutate,
missing.frames = any(framesOccluded > 0))
# extract these trials number
trial.na.frame <- unique(subset(testData, missing.frames)$trialN)
# pick a random bad trial
badTrialNum <- 40
testTrial <- subset(testData, trialN == badTrialNum)
# plot the data
ggplot(aes(frameN, thumbXraw, color = fingersOccluded), data = testTrial) + geom_point() # thumb data is bad
ggplot(aes(frameN, indexXraw, color = fingersOccluded), data = testTrial) + geom_point() # index data is OK
5e-6
5e-06
library(kinesis)
10e-18
1e-18
# repair missing frames
testTrial$indexXrep <- with(testTrial, kin.smooth.repair(time,indexXraw, maxFrames= 20, fingersOccluded=fingersOccluded, framesOccluded=framesOccluded))
testTrial$indexYrep <- with(testTrial, kin.smooth.repair(time,indexYraw, maxFrames= 20, fingersOccluded=fingersOccluded, framesOccluded=framesOccluded))
testTrial$indexZrep <- with(testTrial, kin.smooth.repair(time,indexZraw, maxFrames= 20, fingersOccluded=fingersOccluded, framesOccluded=framesOccluded))
testTrial$thumbXrep <- with(testTrial, kin.smooth.repair(time,thumbXraw, maxFrames= 20, fingersOccluded=fingersOccluded, framesOccluded=framesOccluded))
testTrial$thumbYrep <- with(testTrial, kin.smooth.repair(time,thumbYraw, maxFrames= 20, fingersOccluded=fingersOccluded, framesOccluded=framesOccluded))
testTrial$thumbZrep <- with(testTrial, kin.smooth.repair(time,thumbZraw, maxFrames= 20, fingersOccluded=fingersOccluded, framesOccluded=framesOccluded))
ggplot(aes(frameN, thumbXrep, color = fingersOccluded), data = testTrial) + geom_point() # thumb data is bad
cumsum(rep(1, 10))
cumsum(c(rep(0,10), rep(1, 10), rep(0,10)))
cumsum(c(rep(0,10), rep(1, 10), rep(0,10), rep(1, 10), rep(0,10)))
cumsum(c(rep(NA,10), rep(1, 10), rep(NA,10), rep(1, 10), rep(NA,10)))
v <- c(rep(0,10), rep(1, 10), rep(0,10), rep(1, 10), rep(0,10))
v*unlist(lapply(rle(fingersOccluded)$lengths, seq_len))
v*unlist(lapply(rle(v)$lengths, seq_len))
testTrial$thumbXraw
testData <- data.check(rtgData_bad[usefCols])
any(testData$fingersOccluded==1) # YES
rtgData_bad$thumbXraw
testTrial$thumbXraw
rtgData_bad$thumbXraw
rtgData_bad$thumbXraw
testTrial$thumbXraw
subset(rtgData_bad, trialN==40)$thumbXraw
testTrial$thumbXraw
subset(rtgData_bad, trialN==40)$thumbXraw
subset(rtgData_bad, trialN==40)$thumbXraw
v <- subset(rtgData_bad, trialN==40)$thumbXraw
plot(v)
ifelse(v == criterion, NA, ifelse(diff(v) < .000001, NA, v))
criterion <- 999
ifelse(v == criterion, NA, ifelse(diff(v) < .000001, NA, v))
testTrial$thumbXraw
ifelse(v == criterion, NA, ifelse(c(NA, diff(v)) < .000001, NA, v))
testTrial$thumbXraw
v.diff <- c(NA, diff(v))
v.diff
ifelse(v == criterion, NA, ifelse(abs(c(NA, diff(v))) < .000001, NA, v))
ifelse(v[-1] == criterion, NA, ifelse(abs(c(NA, diff(v))) < .000001, NA, v[-1]))
ifelse(v == criterion, NA, ifelse(abs(c(NA, diff(v))) < .000001, NA, v))
ifelse(abs(c(NA, diff(v))) < .000001, NA, ifelse(v == criterion, NA))
ifelse(abs(c(NA, diff(v))) < .000001, NA, ifelse(v == criterion, NA, v))
kin.missing.frames <- function(v) {c(v[1], ifelse(abs(c(NA, diff(v))) < .000001, NA, ifelse(v == criterion, NA, v))[-1])}
v
kin.missing.frames(v)
criterion <- c(275.31, 999)
kin.missing.frames <- function(v) {c(v[1], ifelse(abs(c(NA, diff(v))) < .000001, NA, ifelse(v %in% criterion, NA, v))[-1])}
kin.missing.frames(v)
v %in% criterion
kin.missing.frames(v)
criterion <- c(276.28, 999)
kin.missing.frames <- function(v) {c(v[1], ifelse(abs(c(NA, diff(v))) < .000001, NA, ifelse(v %in% criterion, NA, v))[-1])}
criterion <- c(998, 999)
v[1] <- 998
kin.missing.frames <- function(v) {c(v[1], ifelse(abs(c(NA, diff(v))) < .000001, NA, ifelse(v %in% criterion, NA, v))[-1])}
kin.missing.frames(v)
v %in% criterion
kin.missing.frames <- function(v) {v[v%in%criterion] <- NA; c(v[1], ifelse(abs(c(NA, diff(v))) < .000001, NA, v))[-1]}
kin.missing.frames(v)
length(kin.missing.frames(v))
length(v)
kin.missing.frames <- function(v) {c(v[1], ifelse(abs(c(NA, diff(v))) < .000001, NA, v))[-1]; v[v%in%criterion] <- NA}
kin.missing.frames(v)
kin.missing.frames(v)
kin.missing.frames <- function(v) {c(v[1], ifelse(abs(c(NA, diff(v))) < .000001, NA, v))[-1]; v[v%in%criterion] <- NA; return(v)}
kin.missing.frames(v)
v
kin.missing.frames <- function(x) {v <- c(x[1], ifelse(abs(c(NA, diff(x))) < .000001, NA, x))[-1]; x[x%in%criterion] <- NA; return(x)}
kin.missing.frames(v)
kin.missing.frames <- function(x) {v <- c(x[1], ifelse(abs(c(NA, diff(x))) < .000001, NA, x))[-1]; v[v%in%criterion] <- NA; return(v)}
kin.missing.frames(v)
criterion <- c(998, 999, 281.9)
kin.missing.frames(v)
criterion <- c(998, 999, 281.90)
kin.missing.frames(v)
v[v%in%criterion]
criterion <- c(998, 999, 281.90)
kin.missing.frames(v)
v[v%in%criterion]
v%in%criterion
criterion
criterion <- c(998, 999, 281.90)
criterion
criterion <- c(998.0, 999.0, 281.90)
kin.missing.frames <- function(x) {v <- c(x[1], ifelse(abs(c(NA, diff(x))) < .000001, NA, x))[-1]; v[v%in%criterion] <- NA; return(v)}
kin.missing.frames(v)
criterion
options(scipen = 999, digits = 3)
criterion
criterion <- c(998, 999, 281.90)
criterion
devtools::document()
library(kinesis)
libraries()
library(cowplot)
# PROCEDURE FROM GALLIVAN and CHAPMAN 2014
#### Prepare the dataset ####
# keep only useful columns
usefCols <- c("trialN","indexXraw","indexYraw","indexZraw","thumbXraw","thumbYraw","thumbZraw")
# Fix dataset
testData <- data.check(rtgData_bad[usefCols])
# is there missing data for each digit in this dataset?
any(testData$fingersOccluded==1) # YES
#### 1. individual trial analysis ####
###  1.1 extract ROI ----
##   1.1.1 fill in missing frames ----
# inpaint_nans function in matlab
# select one trial with missing frames
# flag trials with missing frames
testData <- ddply(testData, .(trialN), mutate,
missing.frames = any(framesOccluded > 0))
# extract these trials number
trial.na.frame <- unique(subset(testData, missing.frames)$trialN)
# pick a random bad trial
badTrialNum <- 40
testTrial <- subset(testData, trialN == badTrialNum)
# plot the data
ggplot(aes(frameN, thumbXraw), data = testTrial) + geom_point() # thumb data is bad
# how many bad frame are there?
max(testTrial$framesOccluded) # 15
# repair missing frames
testTrial$indexXrep <- with(testTrial, kin.smooth.repair(time,indexXraw, maxFrames= 20, fingersOccluded=fingersOccluded, framesOccluded=framesOccluded))
testTrial$indexYrep <- with(testTrial, kin.smooth.repair(time,indexYraw, maxFrames= 20, fingersOccluded=fingersOccluded, framesOccluded=framesOccluded))
testTrial$indexZrep <- with(testTrial, kin.smooth.repair(time,indexZraw, maxFrames= 20, fingersOccluded=fingersOccluded, framesOccluded=framesOccluded))
testTrial$thumbXrep <- with(testTrial, kin.smooth.repair(time,thumbXraw, maxFrames= 20, fingersOccluded=fingersOccluded, framesOccluded=framesOccluded))
testTrial$thumbYrep <- with(testTrial, kin.smooth.repair(time,thumbYraw, maxFrames= 20, fingersOccluded=fingersOccluded, framesOccluded=framesOccluded))
testTrial$thumbZrep <- with(testTrial, kin.smooth.repair(time,thumbZraw, maxFrames= 20, fingersOccluded=fingersOccluded, framesOccluded=framesOccluded))
testTrial$thumbXraw
v <- subset(rtgData_bad, trialN==40)$thumbXraw
plot(v)
criterion <- c(998, 999, 281.90)
criterion
v[1] <- 998
kin.missing.frames <- function(x) {v <- c(x[1], ifelse(abs(c(NA, diff(x))) < .000001, NA, x))[-1]; v[v%in%criterion] <- NA; return(v)}
kin.missing.frames(v)
criterion <- c(998, 999, 281.903315)
kin.missing.frames(v)
v <- subset(rtgData_bad, trialN==40)$thumbXraw
criterion <- c(999)
kin.missing.frames(v)
options(scipen = 1, digits = 3)
kin.missing.frames(v)
v <- subset(rtgData_bad, trialN==40)$thumbXraw
criterion <- c(999)
kin.missing.frames(v)
kin.missing.frames <- function(x) {v <- c(x[1], ifelse(abs(diff(x)) < .000001, NA, x))[-1]; v[v%in%criterion] <- NA; return(v)}
kin.missing.frames(v)
kin.missing.frames <- function(x) {v <- c(x[1], ifelse(abs(c(NA, diff(x))) < .000001, NA, x))[-1]; v[v%in%criterion] <- NA; return(v)}
kin.missing.frames(v)
kin.missing.frames <- function(x) {v <- c(x[1], ifelse(abs(c(NA, diff(x))) < .000001, NA, x)); v[v%in%criterion] <- NA; return(v)}
kin.missing.frames(v)
length(kin.missing.frames(v))
kin.missing.frames <- function(x) {v <- c(x[1], ifelse(abs(c(NA, diff(x))) < .000001, NA, x)[-1]); v[v%in%criterion] <- NA; return(v)}
kin.missing.frames(v)
length(kin.missing.frames(v))
length(v)
kin.missing.frames(v)
kin.missing.frames <- function(x, criterion==NULL) {v <- c(x[1], ifelse(abs(c(NA, diff(x))) < .000001, NA, x)[-1]); v[v%in%criterion] <- NA; return(v)}
kin.missing.frames <- function(x, criterion=NULL) {v <- c(x[1], ifelse(abs(c(NA, diff(x))) < .000001, NA, x)[-1]); v[v%in%criterion] <- NA; return(v)}
kin.missing.frames(v)
library(kinesis)
kin.missing.frames(v)
library(kinesis)
devtools::document()
kin.signal.missing(v)
vm <- kin.signal.missing(v)
ifelse(is.na(vm), 1, 0)
vm.flag <- ifelse(is.na(vm), 1, 0)
unlist(lapply(rle(vm.flag)$lengths, seq_len))
vm.flag * unlist(lapply(rle(vm.flag)$lengths, seq_len))
vm.fit <- predict(sreg(time, vm))
time <- subset(rtgData_bad, trialN==40)$
kin.signal.repair(x, maxFrames = 18)
data.check(rtgData_bad[usefCols])
library(kinesis)
v <- subset(rtgData_bad, trialN==40)$thumbXraw
time <- subset(rtgData_bad, trialN==40)$
kin.signal.repair(x, maxFrames = 18)
time <- testTrial$time
vm.fit <- predict(sreg(time, vm))
vm.fit
frameN <- testTrial$frameN
vm.fit <- predict(sreg(time, vm))
vm.fit1 <- predict(sreg(frameN, vm))
plot(vm.fit, vm.fit1)
vm <- kin.signal.missing(v)
frames <- 1:length(vm)
vm.fit <- predict(sreg(frames, vm))
vm.flag <- ifelse(is.na(vm), 1, 0)
vm.flag.count <- vm.flag * unlist(lapply(rle(vm.flag)$lengths, seq_len))
vm.fit <- predict(sreg(frames, vm)) * vm.flag.count
vm.flag.count
predict(sreg(frames, vm))
vm.fit
split(vm.flag, 0)
?split(vm.flag, 0)
base::split(vm.flag, 0)
base::split(vm.flag, c(0,1))
base::split(vm.flag, as.factor(c(0,1)))
base::split(as.factor(vm.flag), c(0,1))
base::split(vm.flag.count, 0)
Hmisc::cut2(v, 0)
Hmisc::cut2(v, c(0,1))
cut(v, c(0,1))
cut(seq_along(vm.flag.count), 0, labels = FALSE)
cut(seq_along(vm.flag.count), c(0,1), labels = FALSE)
cut(seq_along(vm.flag), c(0,1), labels = FALSE)
seq_along(vm.flag.count)
cut(seq_along(vm.flag.count), 2, labels = FALSE)
